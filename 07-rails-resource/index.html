<html ng-app="resource-demo">
<head>
  <title>07-rails-resource</title>

  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.3/angular.min.js" ></script>

  <script src="resource.js" ></script>
  <link rel="stylesheet" href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css">

  <script>
  app = angular.module("resource-demo", ['rails']);
  app.factory('Post', ['railsResourceFactory', function (railsResourceFactory) {
      return railsResourceFactory({
        url: 'http://localhost:3000/posts', 
        name: 'post', 
        pluralName: 'posts'
      });
  }]);

  app.config( function($routeProvider, $httpProvider) {
  }); 

  function BlogController($scope, Post) {
    $scope.posts = Post.query();

    $scope.deletePost = function(post) {
      post.remove().then(function(result){
        // reload for now
        $scope.posts = Post.query();
      })
    };

    $scope.addPost = function() {
      var newPost = new Post({title:$scope.post_title, body:$scope.post_body, published:$scope.post_published});       
      $scope.post_title = "";
      $scope.post_body = "";
      $scope.post_published = false;
      newPost.create().then(function(result){
        $scope.posts.push(newPost)
      })
    };

  } // BlogController end

  BlogController.$inject = ['$scope','Post'];
  </script>

</head>
<body>
  This example uses the <a href="https://github.com/tpodom/angularjs-rails-resource">angularjs-rails-resource</a> AngularJS extension.
  <div ng-controller="BlogController" style="width:400px; margin-left:auto; margin-right:auto;">
    <table class="table table-striped">
    <thead>
      <tr>
        <th>Id</th>
        <th>Title</th>
        <th>Body</th>
        <th>Published</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="post in posts">
        <td>{{post.id}}</td>
        <td>{{post.title}}</td>
        <td>{{post.body}}</td>
        <td>{{post.published}}</td>
        <td><a href ng-click='deletePost(post)'>Remove</a></td>
      </tr>

      <tr>
        <td></td>
        <td><input size="20" type="text" ng-model="post_title"></td>
        <td><textarea ng-model="post_body"></textarea></td>
        <td><input type="checkbox" ng-model="post_published"></td>
        <td><a href ng-click='addPost()'>Add</a></td>
      </tr>
    
    </tbody>
  </table>
  </div>
</body>
</html>